import{_ as j}from"./_plugin-vue_export-helper.DlAUqK2U.js";import{c as o,a as e,b as f,t as s,F as h,r as v,d as w,e as m,o as C,f as r,n as E}from"./runtime-core.esm-bundler.CZed73ja.js";const I={__name:"AdminDashboard",setup(S,{expose:t}){t();const k=()=>{localStorage.removeItem("token"),window.location.href="/login"},n=m([]),g=m(!0),y=m(null),l=m(null),u="https://inmobiliariabackend-cxa2eegkg0dpdjcs.centralus-01.azurewebsites.net/api/offer";let d=null;C(()=>{const a=document.getElementById("offerModal");a&&(d=bootstrap.Modal.getOrCreateInstance(a)),p()});const p=async()=>{const a=localStorage.getItem("token");if(!a){window.location.href="/login";return}try{const c=await(await fetch(`${u}/admin/get_offers`,{method:"POST",headers:{"Content-Type":"application/json","x-token":a}})).json();if(!c.status)throw new Error(c.message||"Error al obtener ofertas");n.value=c.data}catch(i){y.value=i.message}finally{g.value=!1}},_={logout:k,offers:n,loading:g,error:y,selectedOffer:l,BASE_URL:u,get modalInstance(){return d},set modalInstance(a){d=a},fetchOffers:p,viewDetails:async a=>{const i=localStorage.getItem("token");try{const b=await(await fetch(`${u}/admin/get_offer_by_id`,{method:"POST",headers:{"Content-Type":"application/json","x-token":i},body:JSON.stringify({offerId:a})})).json();b.status?(l.value=b.data,d&&d.show()):alert(b.message)}catch{alert("Error al cargar detalles")}},handleAction:async(a,i)=>{const c=localStorage.getItem("token"),b=i==="accept"?"accept_offer":i==="reject"?"reject_offer":null;if(b)try{const O=await(await fetch(`${u}/admin/${b}`,{method:"POST",headers:{"Content-Type":"application/json","x-token":c},body:JSON.stringify({offerId:a})})).json();O.status?(p(),d&&d.hide()):alert(O.message)}catch{alert("Error al procesar la acción")}},ref:m,onMounted:C};return Object.defineProperty(_,"__isScriptSetup",{enumerable:!1,value:!0}),_}},D={class:"container mt-5"},A={key:0,class:"text-center"},N={key:1,class:"alert alert-danger"},T={key:2,class:"table table-bordered"},P=["onClick"],M={class:"modal fade",id:"offerModal",tabindex:"-1","aria-labelledby":"offerModalLabel","aria-hidden":"true"},B={class:"modal-dialog modal-lg modal-dialog-centered"},V={key:0,class:"modal-content"},z={class:"modal-body"},L={key:0},F=["href"],J={class:"modal-footer"},R=["disabled"],U=["disabled"];function q(S,t,k,n,g,y){return r(),o(h,null,[e("div",D,[e("div",{class:"d-flex justify-content-between align-items-center mb-4"},[t[3]||(t[3]=e("h2",null,"Panel de administración",-1)),e("button",{class:"btn btn-outline-danger",onClick:n.logout},t[2]||(t[2]=[e("i",{class:"bi bi-box-arrow-right me-1"},null,-1),f(" Cerrar sesión ")]))]),n.loading?(r(),o("div",A,"Cargando...")):n.error?(r(),o("div",N,s(n.error),1)):(r(),o("table",T,[t[5]||(t[5]=e("thead",null,[e("tr",null,[e("th",null,"#"),e("th",null,"Nombre"),e("th",null,"Email"),e("th",null,"Inmueble"),e("th",null,"Estado"),e("th",null,"Acciones")])],-1)),e("tbody",null,[(r(!0),o(h,null,v(n.offers,(l,u)=>(r(),o("tr",{key:l.id},[e("td",null,s(u+1),1),e("td",null,s(l.fullName),1),e("td",null,s(l.email),1),e("td",null,s(l.Property?.address||"-"),1),e("td",null,[e("span",{class:E({"badge bg-secondary":l.status==="pendiente","badge bg-success":l.status==="aceptada","badge bg-danger":l.status==="rechazada"})},s(l.status),3)]),e("td",null,[e("button",{class:"btn btn-outline-info btn-sm me-2",onClick:d=>n.viewDetails(l.id)},t[4]||(t[4]=[e("i",{class:"bi bi-eye"},null,-1)]),8,P)])]))),128))])]))]),e("div",M,[e("div",B,[n.selectedOffer?(r(),o("div",V,[t[14]||(t[14]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"offerModalLabel"},"Detalle de la oferta"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Cerrar"})],-1)),e("div",z,[e("p",null,[t[6]||(t[6]=e("strong",null,"Nombre:",-1)),f(" "+s(n.selectedOffer.fullName),1)]),e("p",null,[t[7]||(t[7]=e("strong",null,"Email:",-1)),f(" "+s(n.selectedOffer.email),1)]),e("p",null,[t[8]||(t[8]=e("strong",null,"Teléfono:",-1)),f(" "+s(n.selectedOffer.phone),1)]),e("p",null,[t[9]||(t[9]=e("strong",null,"Valor ofrecido:",-1)),f(" $"+s(n.selectedOffer.offerValue),1)]),e("p",null,[t[10]||(t[10]=e("strong",null,"Estado:",-1)),f(" "+s(n.selectedOffer.status),1)]),e("p",null,[t[11]||(t[11]=e("strong",null,"Inmueble:",-1)),f(" "+s(n.selectedOffer.Property?.address||"Sin dirección"),1)]),n.selectedOffer.OfferDocuments?.length?(r(),o("div",L,[t[12]||(t[12]=e("h5",null,"Documentos",-1)),e("ul",null,[(r(!0),o(h,null,v(n.selectedOffer.OfferDocuments,l=>(r(),o("li",{key:l.id},[e("a",{href:l.fileUrl,target:"_blank"},s(l.type),9,F)]))),128))])])):w("",!0)]),e("div",J,[e("button",{class:"btn btn-success",onClick:t[0]||(t[0]=l=>n.handleAction(n.selectedOffer.id,"accept")),disabled:n.selectedOffer.status!=="pendiente"}," Aceptar ",8,R),e("button",{class:"btn btn-danger",onClick:t[1]||(t[1]=l=>n.handleAction(n.selectedOffer.id,"reject")),disabled:n.selectedOffer.status!=="pendiente"}," Rechazar ",8,U),t[13]||(t[13]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," Cerrar ",-1))])])):w("",!0)])])],64)}const W=j(I,[["render",q]]);export{W as default};
