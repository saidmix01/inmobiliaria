import{v as i,w as q}from"./runtime-dom.esm-bundler.TiLjfoSv.js";import{_ as E}from"./_plugin-vue_export-helper.DlAUqK2U.js";import{c,t as d,a as o,b as N,d as h,w as m,e as s,o as I,f}from"./runtime-core.esm-bundler.CZed73ja.js";const U={__name:"OfferForm",setup(k,{expose:e}){e();const u="https://inmobiliariabackend-cxa2eegkg0dpdjcs.centralus-01.azurewebsites.net",r=s(""),b=s(null),p=s(!0),l=s(null),v=s(""),y=s(""),_=s(null),g=s(null),n=s({documentId:"",fullName:"",address:"",phone:"",email:"",offerValue:""}),w=async()=>{try{const a=await(await fetch(`${u}/api/properties/get_properties_by_id`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({property_id:r.value})})).json();if(!a.status)throw new Error(a.message);b.value=a.data}catch{l.value="No se pudo cargar el inmueble."}finally{p.value=!1}},O=async()=>{v.value="",y.value="";const t=new FormData;t.append("propertyId",r.value),t.append("documentId",n.value.documentId),t.append("fullName",n.value.fullName),t.append("address",n.value.address),t.append("phone",n.value.phone),t.append("email",n.value.email),t.append("offerValue",n.value.offerValue),t.append("identificacion",_.value.files[0]),t.append("certificado_ingresos",g.value.files[0]);try{const V=await(await fetch(`${u}/api/offer/create_offer`,{method:"POST",body:t})).json();if(V.status)v.value="Oferta enviada exitosamente.";else throw new Error(V.message)}catch(a){y.value=a.message||"Error al enviar la oferta."}};I(()=>{const a=window.location.pathname.split("/");r.value=a[a.length-1],console.log("📦 ID desde URL:",r.value),r.value?w():(l.value="No se recibió el ID del inmueble.",p.value=!1)});const x={apiUrl:u,propertyId:r,property:b,loading:p,error:l,success:v,submitError:y,identificacionRef:_,certificadoRef:g,form:n,fetchProperty:w,submitOffer:O,ref:s,onMounted:I};return Object.defineProperty(x,"__isScriptSetup",{enumerable:!1,value:!0}),x}},D={key:0,class:"text-center"},S={key:1,class:"alert alert-danger"},j={key:2},P={class:"mb-4"},T={class:"mb-4"},C=["src"],R={class:"mt-2"},F={class:"row"},B={class:"col-md-6 mb-3"},M={class:"col-md-6 mb-3"},z={class:"col-md-6 mb-3"},A={class:"col-md-6 mb-3"},J={class:"col-md-6 mb-3"},L={class:"col-md-6 mb-3"},G={class:"col-md-6 mb-3"},H={ref:"identificacionRef",type:"file",accept:"application/pdf",class:"form-control",required:""},K={class:"col-md-6 mb-3"},Q={ref:"certificadoRef",type:"file",accept:"application/pdf",class:"form-control",required:""},W={key:0,class:"alert alert-success mt-3"},X={key:1,class:"alert alert-danger mt-3"};function Y(k,e,u,r,b,p){return r.loading?(f(),c("div",D,"Cargando inmueble...")):r.error?(f(),c("div",S,d(r.error),1)):(f(),c("div",j,[o("h2",P,"Aplicar oferta para: "+d(r.property.address),1),o("div",T,[o("img",{src:r.property.image_url,class:"img-fluid rounded shadow-sm",alt:"Imagen del inmueble",style:{"max-height":"300px","object-fit":"cover"}},null,8,C),o("p",R,[e[6]||(e[6]=o("strong",null,"Área:",-1)),N(" "+d(r.property.area)+" m²",1)]),o("p",null,[e[7]||(e[7]=o("strong",null,"Precio:",-1)),N(" $"+d(r.property.price),1)])]),o("form",{onSubmit:q(r.submitOffer,["prevent"]),enctype:"multipart/form-data"},[o("div",F,[o("div",B,[e[8]||(e[8]=o("label",{class:"form-label"},"Número de documento",-1)),m(o("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>r.form.documentId=l),type:"text",class:"form-control",required:""},null,512),[[i,r.form.documentId]])]),o("div",M,[e[9]||(e[9]=o("label",{class:"form-label"},"Nombre completo",-1)),m(o("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>r.form.fullName=l),type:"text",class:"form-control",required:""},null,512),[[i,r.form.fullName]])]),o("div",z,[e[10]||(e[10]=o("label",{class:"form-label"},"Dirección",-1)),m(o("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>r.form.address=l),type:"text",class:"form-control",required:""},null,512),[[i,r.form.address]])]),o("div",A,[e[11]||(e[11]=o("label",{class:"form-label"},"Teléfono",-1)),m(o("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>r.form.phone=l),type:"text",class:"form-control",required:""},null,512),[[i,r.form.phone]])]),o("div",J,[e[12]||(e[12]=o("label",{class:"form-label"},"Correo electrónico",-1)),m(o("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>r.form.email=l),type:"email",class:"form-control",required:""},null,512),[[i,r.form.email]])]),o("div",L,[e[13]||(e[13]=o("label",{class:"form-label"},"Valor ofertado",-1)),m(o("input",{"onUpdate:modelValue":e[5]||(e[5]=l=>r.form.offerValue=l),type:"number",class:"form-control",required:""},null,512),[[i,r.form.offerValue]])]),o("div",G,[e[14]||(e[14]=o("label",{class:"form-label"},"PDF de identificación",-1)),o("input",H,null,512)]),o("div",K,[e[15]||(e[15]=o("label",{class:"form-label"},"Certificado de ingresos",-1)),o("input",Q,null,512)])]),e[16]||(e[16]=o("button",{type:"submit",class:"btn btn-success"},"Enviar oferta",-1)),r.success?(f(),c("div",W,d(r.success),1)):h("",!0),r.submitError?(f(),c("div",X,d(r.submitError),1)):h("",!0)],32)]))}const oe=E(U,[["render",Y]]);export{oe as default};
